services:
  web:
    build:
      context: .
      dockerfile: docker/php/Dockerfile.prod
    depends_on:
      redis:
        condition: service_started
    environment:
      APP_ENV: production
      RUN_MIGRATIONS: 0

  queue:
    build:
      context: .
      dockerfile: docker/php/Dockerfile.prod
    depends_on:
      redis:
        condition: service_started
    environment:
      APP_ENV: production
    command: ["php", "artisan", "queue:work", "--sleep=1", "--tries=3", "--timeout=90"]

  scheduler:
    build:
      context: .
      dockerfile: docker/php/Dockerfile.prod
    depends_on:
      redis:
        condition: service_started
    environment:
      APP_ENV: production
    command: ["php", "artisan", "schedule:work"]

  redis:
    image: redis:7-alpine
